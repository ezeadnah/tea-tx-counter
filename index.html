<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tea Protocol - Transaction Counter (Tea Sepolia Testnet)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.11.1/ethers.umd.min.js" integrity="sha512-DXQhlt9OmeEY79J6zPzBvHk5j1z8o+wFkRLwGSj27jTqIOhN/uG2QG7jXlPHq3OCAF7GdJ/uU/3EZ7q1A0XphQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Custom styles if needed */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as preferred */
        }
        /* Add a subtle background pattern or color */
        html {
             background-color: #f7fafc; /* Light gray background */
        }
    </style>
     <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-lg">
        <div class="text-center mb-6 sm:mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Tea Protocol</h1>
            <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mt-1">Transaction Counter</h2>
            <p class="text-sm text-gray-500 mt-2">Check transaction count (nonce) on Tea Sepolia Testnet</p>
        </div>

        <div class="mb-4">
            <label for="walletAddress" class="block text-sm font-medium text-gray-700 mb-1">Wallet Address</label>
            <input type="text" id="walletAddress" name="walletAddress" class="w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Enter Tea Sepolia wallet address (e.g., 0x...)">
        </div>

        <div class="mb-6">
            <button id="checkButton" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-200 ease-in-out flex items-center justify-center space-x-2">
                <svg id="button-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <span>Check Transaction Count</span>
                 <svg id="loading-spinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </div>

        <div id="resultArea" class="text-center p-4 bg-gray-50 rounded-lg min-h-[60px] flex items-center justify-center border border-gray-200">
            <span class="text-gray-500">Enter an address and click check.</span>
        </div>
         </div>

    <script>
        // Get references to DOM elements
        const addressInput = document.getElementById('walletAddress');
        const checkButton = document.getElementById('checkButton');
        const resultArea = document.getElementById('resultArea');
        const loadingSpinner = document.getElementById('loading-spinner');
        const buttonIcon = document.getElementById('button-icon');
        const buttonText = checkButton.querySelector('span');

        // *** CORRECTED RPC URL for Tea Sepolia Testnet via Alchemy ***
        const TEA_SEPOLIA_RPC_URL = 'https://tea-sepolia.g.alchemy.com/public'; // Updated URL

        // Initialize ethers provider
        let provider;
        try {
             // Use the updated RPC URL
            provider = new ethers.JsonRpcProvider(TEA_SEPOLIA_RPC_URL);
            console.log("JsonRpcProvider initialized successfully for Tea Sepolia (Alchemy)."); // Updated log
        } catch (error) {
            console.error("Failed to initialize JsonRpcProvider:", error);
            resultArea.innerHTML = `<span class="text-red-600 font-medium">Error: Could not initialize blockchain connection.</span>`;
            checkButton.disabled = true; // Disable button if provider fails
        }

        // Function to show loading state
        function showLoading(isLoading) {
            if (isLoading) {
                buttonText.textContent = 'Checking...';
                buttonIcon.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');
                checkButton.disabled = true;
                resultArea.innerHTML = `<span class="text-gray-500">Fetching data...</span>`;
            } else {
                buttonText.textContent = 'Check Transaction Count';
                buttonIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                checkButton.disabled = false;
            }
        }

        // Add event listener to the button
        checkButton.addEventListener('click', async () => {
            const address = addressInput.value.trim();

            resultArea.innerHTML = '';

            if (!ethers.isAddress(address)) {
                resultArea.innerHTML = `<span class="text-red-600 font-medium">Error: Invalid wallet address format.</span>`;
                return;
            }

            showLoading(true);

            try {
                if (!provider) {
                    throw new Error("Blockchain provider not initialized.");
                }

                const txCount = await provider.getTransactionCount(address);

                resultArea.innerHTML = `
                    <span class="text-lg font-semibold text-gray-800">Transaction Count:</span>
                    <span class="text-lg font-bold text-indigo-600 ml-2">${txCount.toString()}</span>
                `;

            } catch (error) {
                console.error("Error fetching transaction count:", error);
                resultArea.innerHTML = `<span class="text-red-600 font-medium">Error: Could not fetch data. Check console or try again.</span>`;
                if (error.message.includes("provider") || error.message.includes("NetworkError") || error.code === 'NETWORK_ERROR' || error.message.includes('fetch failed')) {
                     resultArea.innerHTML = `<span class="text-red-600 font-medium">Error: Network issue. Could not reach the Tea Sepolia network RPC.</span>`;
                }
            } finally {
                showLoading(false);
            }
        });

         // Optional: Allow pressing Enter in the input field to trigger the check
        addressInput.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkButton.click();
            }
        });

    </script>

</body>
</html>
